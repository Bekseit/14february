<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíñ Valentine Invite</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#ffd6e8;
      --bg2:#ffe9c6;
      --bg3:#d9d2ff;

      --card: rgba(255,255,255,.62);
      --card-border: rgba(255,255,255,.55);

      --text:#3a2c34;
      --muted:#6a5863;

      --yes:#ff5fa2;
      --yes2:#ff86bd;

      --no:#ffffff;
      --no-border: rgba(58,44,52,.18);

      --shadow: 0 18px 60px rgba(30, 10, 20, .18);
      --radius: 26px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      overflow-x:hidden;
      background:
        radial-gradient(800px 500px at 20% 20%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(700px 500px at 85% 30%, rgba(255,255,255,.40), transparent 60%),
        radial-gradient(900px 600px at 50% 90%, rgba(255,255,255,.35), transparent 65%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      transition: background .6s ease, color .3s ease;
    }

    /* HACK MODE: dark theme + red, strikethrough */
    body.dark-hack{
      background:
        radial-gradient(900px 600px at 20% 20%, rgba(255,0,60,.10), transparent 60%),
        radial-gradient(900px 700px at 80% 30%, rgba(0,255,120,.08), transparent 60%),
        radial-gradient(1100px 700px at 50% 95%, rgba(0,120,255,.10), transparent 70%),
        linear-gradient(135deg, #0b0c10, #111316, #070709);
      color: #ff2b2b;
    }
    body.dark-hack .sub,
    body.dark-hack .hint,
    body.dark-hack .counter,
    body.dark-hack .details .k{
      color: rgba(255,60,60,.85);
    }
    body.dark-hack h1,
    body.dark-hack #inviteText,
    body.dark-hack #subtitle,
    body.dark-hack #miniText{
      color:#ff2b2b;
      text-decoration: line-through;
      text-decoration-thickness: 2px;
      text-decoration-color: rgba(255, 0, 0, .65);
    }
    body.dark-hack .card{
      background: rgba(10, 10, 12, .40);
      border: 1px solid rgba(255, 0, 60, .20);
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
    }
    body.dark-hack .sparkle{ opacity:.12; }

    /* Floating hearts background */
    .bg{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
    }
    .heart{
      position:absolute;
      bottom:-40px;
      font-size:18px;
      opacity:.45;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.08));
      animation: floatUp linear infinite;
      transform: translateY(0) scale(1);
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0% { transform: translateY(0) translateX(0) scale(var(--s)); opacity:0; }
      10%{ opacity:var(--o); }
      90%{ opacity:var(--o); }
      100%{ transform: translateY(calc(-1 * (100vh + 120px))) translateX(var(--x)) scale(var(--s)); opacity:0; }
    }
    body.dark-hack .heart{
      opacity:.55;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.35));
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:24px 16px;
      position:relative;
      z-index:1;
    }

    .topbar{
      position:fixed;
      top:14px;
      right:14px;
      display:flex;
      gap:10px;
      z-index:3;
    }
    .chip{
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.5);
      box-shadow: 0 10px 30px rgba(0,0,0,.10);
      border-radius:999px;
      padding:10px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    body.dark-hack .chip{
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(0,255,120,.12);
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
      color: rgba(0,255,120,.85);
    }
    .chip small{ color:var(--muted); font-weight:800; }
    body.dark-hack .chip small{ color: rgba(0,255,120,.75); }
    .chip button{
      border:0;
      background:transparent;
      font:inherit;
      cursor:pointer;
      padding:8px 10px;
      border-radius:999px;
      font-weight:900;
      color:var(--text);
    }
    body.dark-hack .chip button{ color: rgba(0,255,120,.9); }
    .chip button:hover{ background: rgba(0,0,0,.06); }
    body.dark-hack .chip button:hover{ background: rgba(0,255,120,.10); }

    .card{
      width:min(560px, 92vw);
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: 28px 22px;
      position:relative;
      overflow: visible;
      transform: translateY(10px) scale(.98);
      opacity:0;
      animation: popIn .7s ease forwards;
    }
    @keyframes popIn{
      to{ transform: translateY(0) scale(1); opacity:1; }
    }

    .sparkle{
      position:absolute;
      inset:-60px -60px auto auto;
      width:220px; height:220px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), transparent 60%);
      transform: rotate(25deg);
      opacity:.65;
      pointer-events:none;
    }

    h1{
      margin:0 0 10px 0;
      font-size: clamp(22px, 4.4vw, 34px);
      line-height:1.12;
      letter-spacing:-.2px;
    }
    .sub{
      margin:0 0 18px 0;
      color: var(--muted);
      font-size: 15.5px;
      line-height:1.35;
      font-weight:800;
    }

    .invite{
      margin:12px 0 14px;
      font-size: 16.5px;
      line-height:1.5;
      font-weight:800;
    }
    .invite .line{ display:block; margin:6px 0; }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13.5px;
      font-weight:900;
      min-height: 20px;
    }

    .buttons{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:16px;
      align-items:center;
    }
    .btn{
      border:0;
      border-radius: 16px;
      padding: 14px 18px;
      font-weight:900;
      font-size:16px;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease, opacity .2s ease;
      user-select:none;
      touch-action: manipulation;
      will-change: transform;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btn-yes{
      background: linear-gradient(135deg, var(--yes), var(--yes2));
      color:white;
      box-shadow: 0 14px 26px rgba(255, 95, 162, .35);
      position:relative;
    }
    .btn-yes::after{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 60%);
      opacity:.35;
      pointer-events:none;
    }
    .btn-yes.pulse{
      animation: softPulse 1.9s ease-in-out infinite;
    }
    @keyframes softPulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.02); }
    }

    .btn-no{
      background: rgba(255,255,255,.72);
      color: var(--text);
      border: 1px solid var(--no-border);
      box-shadow: 0 12px 24px rgba(0,0,0,.10);
      position: relative;
    }

    .btn-no.floating-no{
      position: fixed !important;
      z-index: 99999 !important;
      will-change: left, top, transform;
    }

    .btn-no.shake{
      animation: shake .35s linear infinite;
    }
    @keyframes shake{
      0%{ transform: translate(0,0) rotate(0deg); }
      25%{ transform: translate(1px,-1px) rotate(-1deg); }
      50%{ transform: translate(-1px,1px) rotate(1deg); }
      75%{ transform: translate(1px,1px) rotate(0deg); }
      100%{ transform: translate(-1px,-1px) rotate(1deg); }
    }

    /* Sad walk to corner (last NO) */
    .btn-no.sad-walk{
      opacity: .92;
      transform: scale(0.42) !important;
      filter: saturate(.9);
    }
    .btn-no.sad-walk::before,
    .btn-no.sad-walk::after{
      content:"";
      position:absolute;
      bottom:-10px;
      width:10px;
      height:10px;
      border: 2px solid rgba(58,44,52,.35);
      border-top:0;
      border-right:0;
      border-radius: 0 0 0 7px;
      transform-origin: top center;
      pointer-events:none;
    }
    .btn-no.sad-walk::before{
      left:18px;
      animation: legL .35s ease-in-out infinite;
    }
    .btn-no.sad-walk::after{
      right:18px;
      animation: legR .35s ease-in-out infinite;
    }
    @keyframes legL{
      0%,100%{ transform: rotate(18deg); }
      50%{ transform: rotate(-18deg); }
    }
    @keyframes legR{
      0%,100%{ transform: rotate(-18deg); }
      50%{ transform: rotate(18deg); }
    }

    .counter{
      margin-top: 14px;
      display:flex;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-weight:900;
      font-size: 13px;
    }
    .badge{
      background: rgba(255,255,255,.70);
      border:1px solid rgba(0,0,0,.08);
      border-radius: 999px;
      padding: 6px 10px;
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
    }

    /* Final screen */
    .final{
      display:none;
      text-align:center;
      padding-top: 6px;
    }
    .final h2{
      margin: 8px 0 6px;
      font-size: clamp(26px, 5vw, 40px);
      line-height:1.1;
      letter-spacing:-.2px;
    }
    .final p{
      margin: 6px 0;
      color: var(--muted);
      font-weight:800;
      line-height:1.35;
    }
    .details{
      margin: 14px auto 4px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.5);
      border-radius: 20px;
      padding: 14px 14px;
      max-width: 440px;
      box-shadow: 0 14px 35px rgba(0,0,0,.10);
      text-align:left;
      font-weight:800;
      color: var(--text);
    }
    .details .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      margin: 10px 0;
    }
    .details .k{
      width: 88px;
      color: var(--muted);
      font-weight:900;
      flex: 0 0 auto;
    }
    .details .v{ flex:1; }

    .actions{
      margin-top: 16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .linkbtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.10);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight:900;
      box-shadow: 0 12px 24px rgba(0,0,0,.10);
      transition: transform .18s ease, background .18s ease;
    }
    .linkbtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.85); }
    .love{
      margin-top: 14px;
      font-weight:900;
      color: var(--text);
      display:inline-block;
      padding: 10px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: 0 14px 35px rgba(0,0,0,.10);
      animation: lovePulse 1.2s ease-in-out infinite;
    }
    @keyframes lovePulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.03); }
    }

    /* Confetti canvas */
    #confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:5;
    }

    /* HACK OVERLAY ‚Äî IMPORTANT: blocks page clicks */
    .hack-overlay{
      position:fixed;
      inset:0;
      z-index:99998;
      pointer-events:auto;
      display:none;
    }
    .hack-overlay.active{ display:block; }

    .hack-dim{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      opacity:0;
      transition: opacity .4s ease;
      pointer-events:auto;
    }
    .hack-overlay.active .hack-dim{ opacity:1; }

    .hack-windows{
      position:absolute;
      inset:0;
      pointer-events:none;
    }
    .term{
      position:absolute;
      width: min(320px, 70vw);
      height: 140px;
      background: rgba(0,0,0,.86);
      border: 1px solid rgba(0,255,120,.45);
      border-radius: 12px;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      overflow:hidden;
      transform: scale(.92);
      opacity:0;
      animation: termIn .18s ease forwards;
    }
    @keyframes termIn{
      to{ transform: scale(1); opacity:1; }
    }
    .term .bar{
      height: 26px;
      display:flex;
      align-items:center;
      gap:8px;
      padding:0 10px;
      background: rgba(255,255,255,.05);
      border-bottom: 1px solid rgba(0,255,120,.18);
      font: 800 12px/1 "Nunito", sans-serif;
      color: rgba(0,255,120,.92);
    }
    .dot{ width:8px; height:8px; border-radius:999px; background: rgba(0,255,120,.65); }
    .term pre{
      margin:0;
      padding:10px 10px;
      font: 700 12px/1.3 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(0,255,120,.90);
      white-space: pre-wrap;
    }

    .hack-center{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%) scale(.96);
      width: min(520px, 90vw);
      background: rgba(0,0,0,.90);
      border: 1px solid rgba(0,255,120,.50);
      border-radius: 16px;
      box-shadow: 0 22px 80px rgba(0,0,0,.75);
      opacity:0;
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
      display:none;
      z-index: 99999;
    }
    .hack-center.show{
      display:block;
      opacity:1;
      transform: translate(-50%,-50%) scale(1);
      pointer-events:auto;
    }
    .hack-center .hdr{
      padding:12px 14px;
      border-bottom: 1px solid rgba(0,255,120,.18);
      color: rgba(0,255,120,.92);
      font: 900 14px/1 "Nunito", sans-serif;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .hack-center .hdr span{ opacity:.9; }
    .hack-center .body{
      padding:14px 14px 16px;
      color: rgba(0,255,120,.92);
      font: 800 13px/1.35 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .hack-center .cta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding: 0 14px 16px;
    }
    .hackbtn{
      pointer-events:auto;
      border:1px solid rgba(0,255,120,.45);
      background: rgba(0,255,120,.12);
      color: rgba(0,255,120,.92);
      border-radius: 12px;
      padding: 12px 14px;
      font: 900 14px/1 "Nunito", sans-serif;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease;
      user-select:none;
    }
    .hackbtn:hover{ background: rgba(0,255,120,.18); transform: translateY(-1px); }

    .music-panel{
      position: fixed;
      right: 12px;
      bottom: 12px;
      z-index: 100000;
      width: 320px;
      max-width: calc(100vw - 24px);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 55px rgba(0,0,0,.25);
      background: rgba(255,255,255,.35);
      backdrop-filter: blur(10px);
    }
    .music-panel.hidden{ display:none; }
    .music-panel iframe{ display:block; width:100%; height:180px; border:0; }
    .intro{
  position: fixed;
  inset: 0;
  z-index: 250000;
  background: #fff;
  display: grid;
  place-items: center;
  overflow: hidden;
  transition: opacity 420ms ease, background 420ms ease;
}

.intro.gone{
  opacity: 0;
  background: rgba(255,255,255,0);
  pointer-events: none;
}

.env{
  position: relative;
  width: min(520px, 92vw);
  height: min(340px, 60vw);
  max-height: 380px;
  transform: translateY(0) scale(1);
  transition: transform 600ms cubic-bezier(.2,.85,.15,1);
  perspective: 1100px;
}

.env-back{
  position:absolute;
  inset: 0;
  border-radius: 22px;
  background:
    radial-gradient(80% 90% at 30% 25%, rgba(255,95,162,.08), transparent 55%),
    radial-gradient(70% 90% at 80% 40%, rgba(255,175,90,.10), transparent 60%),
    linear-gradient(180deg, #ffffff, #fbfbfd);
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 26px 80px rgba(0,0,0,.12);
}

/* Base flaps */
.env-flap{
  position:absolute;
  inset: 0;
  border-radius: 22px;
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 55px rgba(0,0,0,.10);
}

/* Left triangle */
.env-left{
  clip-path: polygon(0 0, 56% 50%, 0 100%);
  transform-origin: left center;
  background: linear-gradient(135deg, rgba(255,95,162,.10), rgba(255,255,255,.95));
}

/* Right triangle */
.env-right{
  clip-path: polygon(100% 0, 44% 50%, 100% 100%);
  transform-origin: right center;
  background: linear-gradient(225deg, rgba(255,95,162,.10), rgba(255,255,255,.95));
}

/* Bottom triangle */
.env-bottom{
  clip-path: polygon(0 100%, 50% 52%, 100% 100%);
  transform-origin: center bottom;
  background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,95,162,.08));
}

/* Top flap (triangle pointing down) */
.env-top{
  clip-path: polygon(0 0, 100% 0, 50% 58%);
  transform-origin: center top;
  transform: rotateX(0deg);
  background: linear-gradient(180deg, rgba(255,95,162,.10), rgba(255,255,255,.92));
  box-shadow: 0 22px 55px rgba(0,0,0,.12);
}

/* Center seam (subtle) */
.env::after{
  content:"";
  position:absolute;
  left:50%;
  top:50%;
  width: min(520px, 92vw);
  height: 2px;
  transform: translate(-50%,-50%);
  background: linear-gradient(90deg, transparent, rgba(255,95,162,.40), transparent);
  opacity:.65;
  pointer-events:none;
}

/* Heart seal button */
.seal{
  position:absolute;
  left:50%;
  top:52%;
  transform: translate(-50%,-50%);
  border: 0;
  cursor: pointer;
  user-select: none;

  padding: 14px 18px 12px;
  border-radius: 18px;

  background: rgba(255,255,255,.96);
  border: 1px solid rgba(0,0,0,.10);
  box-shadow: 0 18px 60px rgba(0,0,0,.16);

  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 6px;

  transition: transform 220ms ease, opacity 220ms ease;
  z-index: 3;
}

.seal:hover{ transform: translate(-50%,-50%) scale(1.02); }
.seal:active{ transform: translate(-50%,-50%) scale(.99); }

.seal-heart{
  font-size: 26px;
  line-height: 1;
  filter: drop-shadow(0 10px 18px rgba(255,95,162,.20));
}

.seal-text{
  font: 900 20px/1 "Nunito", system-ui, sans-serif;
  color:#3a2c34;
}

.seal-sub{
  font: 800 13px/1.2 "Nunito", system-ui, sans-serif;
  color: rgba(58,44,52,.65);
}

/* OPEN animation */
.intro.open .env{
  transform: translateY(-6px) scale(1.02);
}

.intro.open .env-top{
  transform: rotateX(175deg);
  box-shadow: none;
}

.intro.open .env-left{
  transform: rotateY(-38deg) translateX(-6px);
  opacity: .95;
}

.intro.open .env-right{
  transform: rotateY(38deg) translateX(6px);
  opacity: .95;
}

.intro.open .env-bottom{
  transform: rotateX(-18deg) translateY(8px);
  opacity: .95;
}

.intro.open .seal{
  opacity: 0;
  transform: translate(-50%,-30%) scale(.92);
  pointer-events:none;
}

/* small sparkle under seal */
.seal::after{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius: 20px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.75), transparent 60%);
  opacity:.55;
  pointer-events:none;
}

    @media (max-width: 420px){
      .btn{ width:100%; justify-content:center; }
      .details .k{ width:78px; }
      .term{ height: 128px; }
    }
  </style>
</head>

<body>

  <!-- INTRO (white envelope screen) -->
  <div id="intro" class="intro" aria-hidden="false">
  <div class="env" id="env">
    <div class="env-back"></div>

    <div class="env-flap env-left"></div>
    <div class="env-flap env-right"></div>
    <div class="env-flap env-bottom"></div>
    <div class="env-flap env-top"></div>

    <button id="introSeal" class="seal" type="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç">
      <span class="seal-heart">üíñ</span>
      <span class="seal-text">–ì–æ—Ç–æ–≤–∞?</span>
      <span class="seal-sub">–Ω–∞–∂–º–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å</span>
    </button>
  </div>
</div>

  <audio id="bgm" preload="auto" loop playsinline>
    <source src="joji.mp3" type="audio/mpeg">
  </audio>
  <audio id="hackBgm" preload="auto" loop playsinline>
  <source src="hacker.mp3" type="audio/mpeg">
</audio>

  <div id="musicPanel" class="music-panel hidden" aria-hidden="true"></div>

  <canvas id="confetti"></canvas>
  <div class="bg" id="bg"></div>

  <!-- HACK prank overlay -->
  <div class="hack-overlay" id="hackOverlay" aria-hidden="true">
    <div class="hack-dim"></div>
    <div class="hack-windows" id="hackWindows"></div>

    <div class="hack-center" id="hackCenter" role="dialog" aria-label="LOVE_VIRUS –ø—Ä–æ—Ç–æ–∫–æ–ª">
      <div class="hdr">
        <span>LOVE_VIRUS.EXE</span>
        <span>‚ö†Ô∏è</span>
      </div>
      <div class="body" id="hackCenterText">
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è‚Ä¶<br/>
        –°–∫–∞–Ω–∏—Ä—É—é —É—Ä–æ–≤–µ–Ω—å –º–∏–ª–æ—Ç—ã‚Ä¶<br/>
        –û—à–∏–±–∫–∞: ¬´–ù–µ—Ç¬ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ü§≠<br/>
        <br/>
        –†–µ—à–µ–Ω–∏–µ: –Ω–∞–∂–º–∏ ¬´–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª¬ª, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥ üíñ
      </div>
      <div class="cta">
        <button class="hackbtn" id="hackStopBtn" type="button">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª (–Ω–∞–∑–∞–¥)</button>
      </div>
    </div>
  </div>

  <div class="topbar">
    <div class="chip" aria-label="–°—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫">
      <small>–ü–æ–ø—ã—Ç–∫–∏ ¬´–ù–µ—Ç¬ª:</small>
      <span class="badge" id="triesBadge">0</span>
    </div>
    <div class="chip" aria-label="–ú—É–∑—ã–∫–∞">
      <button id="musicBtn" type="button" aria-label="–í–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">üîà Music</button>
    </div>
  </div>

  <main class="wrap">
    <section class="card" id="card" aria-label="–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ">
      <div class="sparkle"></div>

      <div id="screenAsk">
        <h1 id="title">–° –ù–∞—Å—Ç—É–ø–∞—é—â–∏–º –î–Ω—ë–º –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞, <span id="nameSpan">[–ï—Ä–∫–µ]</span> üíñ</h1>
        <p class="sub" id="subtitle">–ú–∞–ª–µ–Ω—å–∫–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è ‚ú®</p>

        <div class="invite" id="inviteText"></div>

        <div class="buttons" id="buttonsRow">
          <button class="btn btn-yes pulse" id="yesBtn" type="button" aria-label="–û—Ç–≤–µ—Ç–∏—Ç—å –î–∞">–î–∞! üíñ</button>
          <button class="btn btn-no" id="noBtn" type="button" aria-label="–û—Ç–≤–µ—Ç–∏—Ç—å –ù–µ—Ç">–ù–µ—Ç </button>
        </div>

        <div class="hint" id="hint"></div>

        <div class="counter" aria-label="–ü–æ–¥—Å–∫–∞–∑–∫–∞ –∏ —Å—á—ë—Ç—á–∏–∫">
          <span>üí°</span>
          <span id="miniText">–ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å ¬´–î–∞¬ª‚Ä¶ —è –Ω–µ –æ–±–∏–∂—É—Å—å üòÑ</span>
        </div>
      </div>

      <div id="screenFinal" class="final" aria-label="–§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω">
        <h2 id="finalTitle">–Ø —Ç–∞–∫ –∏ –∑–Ω–∞–ª —á—Ç–æ —Ç—ã —Å–∫–∞–∂–µ—à—å –î–ê üòéüíñ</h2>
        <p id="finalSubtitle">–¢–æ–≥–¥–∞ 14 —Ñ–µ–≤—Ä–∞–ª—è ‚Äî –Ω–∞—à–µ —Å–≤–∏–¥–∞–Ω–∏–µ!</p>

        <div class="details" aria-label="–î–µ—Ç–∞–ª–∏ —Å–≤–∏–¥–∞–Ω–∏—è">
          <div class="row">
            <div class="k">üìÖ –î–∞—Ç–∞</div>
            <div class="v" id="dDate">14 —Ñ–µ–≤—Ä–∞–ª—è</div>
          </div>
          <div class="row">
            <div class="k">üïñ –í—Ä–µ–º—è</div>
            <div class="v" id="dTime">12:00</div>
          </div>
          <div class="row">
            <div class="k">üìç –ú–µ—Å—Ç–æ</div>
            <div class="v" id="dPlace">[–º–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏]</div>
          </div>
        </div>

        <div class="actions" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
          <a class="linkbtn" id="mapLink" href="#" target="_blank" rel="noreferrer">–û—Ç–∫—Ä—ã—Ç—å –º–µ—Å—Ç–æ üìç</a>
          <a class="linkbtn" id="calLink" href="#" download="valentine.ics">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å üóìÔ∏è</a>
          <a class="linkbtn" id="chatLink" href="#" target="_blank" rel="noreferrer">–ù–∞–ø–∏—Å–∞—Ç—å –º–Ω–µ üí¨</a>
        </div>

        <div class="love" id="loveNote">–õ—é–±–ª—é —Ç–µ–±—è üíñ</div>
      </div>
    </section>
  </main>

  <script>
    /**********************
     *  SETTINGS (edit here)
     **********************/
    const SETTINGS = {
      defaultName: "–ï—Ä–∫–µ",
      inviteLines: [
        "–£ –º–µ–Ω—è –∫ —Ç–µ–±–µ –≤–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å‚Ä¶",
        "–ü–æ–≥—É–ª—è–µ–º –≤–º–µ—Å—Ç–µ 14 —Ñ–µ–≤—Ä–∞–ª—è?",
        "–ò‚Ä¶ —Å—Ç–∞–Ω–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π? ü•∫üíò"
      ],

      dateText: "14 —Ñ–µ–≤—Ä–∞–ª—è 2026",
      timeText: "12:00",
      placeText: "–ë–∞–π—Ç–µ—Ä–µ–∫ (—Ä—è–¥–æ–º —Ä–µ—Å—Ç–∏–∫ –Ω–µ –±–æ–π—Å—è –Ω–æ —Ç–æ–ª—å–∫–æ —á—É—Ç—å –ø—Ä–æ–π–¥–µ–º—Å—è)",

      mapUrl: "https://maps.google.com/?q=Central+Park",
      chatUrl: "https://t.me/",
      event: {
        title: "Valentine Date üíñ",
        location: "Our cute meeting place",
        start: "20260214T190000",
        end:   "20260214T210000",
        description: "–°–≤–∏–¥–∞–Ω–∏–µ 14 —Ñ–µ–≤—Ä–∞–ª—è üíò"
      },

      yesLabels: [
        "–î–∞! üíñ",
        "–î–∞-–¥–∞ üò≥",
        "–ö–æ–Ω–µ—á–Ω–æ –¥–∞ üíò",
        "–î–ê–ê–ê üíû",
        "–ù—É –¥–∞–≤–∞–π üíó",
        "–Ø —É–≥–æ—â–∞—é ‚òïüç∞",
        "–ù–£ –°–ö–ê–ñ–ò –î–ê–ê üò≠üíñ",
        "–ñ–∞–ª–∫–æ —á—Ç–æ –ª–∏? ü•∫",
        "–¢–µ–±—è –Ω–µ –≥–æ–≤–æ—Ä–∏–ª–∏ –∑–ª—é–∫–æ–π –±—ã—Ç—å –ø–ª–æ—Ö–æ? üòà",
        "–ù—É –Ω–µ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —è –ø–ª–æ—Ö üò≥",
        "—è —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª –ø–æ–∂–∞–ª—É–π—Å—Ç–∞? ü•π",
      ],

      funnyModeAfter: 7,
      maxTries: 10,

      yesScaleMax: 1.75,
      yesScaleStepMin: 1.10,
      yesScaleStepMax: 1.15,

      noInitialShiftRight: 26,

      hack: {
        spawnIntervalMs: 170,
        maxWindows: 40,
        centerShowAfter: 18
      }
    };

    /**********************
     *  Helpers
     **********************/
    const $ = (id) => document.getElementById(id);

    const nameSpan = $("nameSpan");
    const inviteText = $("inviteText");
    const yesBtn = $("yesBtn");
    const noBtn = $("noBtn");
    const hint = $("hint");
    const miniText = $("miniText");
    const triesBadge = $("triesBadge");
    const screenAsk = $("screenAsk");
    const screenFinal = $("screenFinal");

    const dDate = $("dDate");
    const dTime = $("dTime");
    const dPlace = $("dPlace");
    const mapLink = $("mapLink");
    const calLink = $("calLink");
    const chatLink = $("chatLink");

    const canvas = $("confetti");
    const ctx = canvas.getContext("2d");

    const hackOverlay = $("hackOverlay");
    const hackWindows = $("hackWindows");
    const hackCenter = $("hackCenter");
    const hackStopBtn = $("hackStopBtn");

    const buttonsRow = $("buttonsRow");

    let tries = 0;
    let yesScale = 1;
    let noIsFixed = false;

    // hack flow flags
    let hackArmed = false;       // after NO went to corner
    let hackRunning = false;

    // anti double-trigger
    let noMoveLock = false;
    let lastNoActionTs = 0;

    let hackTimer = null;
    let hackCount = 0;

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
    function setTries(n){ triesBadge.textContent = String(n); }

    function escapeHtml(str){
      return str.replace(/[&<>"']/g, s => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;"
      }[s]));
    }

    function getNameFromQuery() {
      const params = new URLSearchParams(location.search);
      const raw = params.get("name");
      if (!raw) return SETTINGS.defaultName;
      return raw.trim().slice(0, 30);
    }

    function renderInviteLines(lines) {
      inviteText.innerHTML = lines.map(t => `<span class="line">${escapeHtml(t)}</span>`).join("");
    }

    function updateMicrocopy() {
      if (tries === 3) hint.textContent = "–≠–π, –Ω—É –ø–æ—á—Ç–∏ –∂–µ –Ω–∞–∂–∞–ª–∞ ¬´–î–∞¬ª üòÑ";
      else if (tries === 4) hint.textContent = "–Ø –≤–∏–¥–µ–ªa! –ü–∞–ª–µ—Ü —Ç—è–Ω—É–ª—Å—è –∫ ¬´–î–∞¬ª üò≥üíû";
      else if (tries === 6) hint.textContent = "–û–π‚Ä¶ –∫–Ω–æ–ø–∫–∞ ¬´–ù–µ—Ç¬ª —è–≤–Ω–æ —Å—Ç–µ—Å–Ω—è–µ—Ç—Å—è ";
      else if (tries >= SETTINGS.funnyModeAfter) hint.textContent = "–õ–∞–¥–Ω–æ-–ª–∞–¥–Ω–æ‚Ä¶ –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ ¬´–î–∞¬ª? ü•∫üíò";
      else hint.textContent = "";

      if (tries === 0) miniText.textContent = "–ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å ¬´–ù–µ—Ç¬ª‚Ä¶ —è –Ω–µ –æ–±–∏–∂—É—Å—å üòÑ";
      else if (tries <= 2) miniText.textContent = "–Ø –≤–∏–¥–µ–ªa! –ü–∞–ª–µ—Ü —Ç—è–Ω—É–ª—Å—è –∫ ¬´–î–∞¬ª üò≥üíû";
      else if (tries <= 5) miniText.textContent = "–õ–∞–¥–Ω–æ-–ª–∞–¥–Ω–æ‚Ä¶ –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ ¬´–î–∞¬ª? ü•∫üíò";
      else miniText.textContent = "–û–∫–µ–π, —ç—Ç–æ —É–∂–µ —Å–ø–æ—Ä—Ç‚Ä¶ –Ω–æ —è –≤–µ—Ä—é –≤ ¬´–î–∞¬ª üíñ";

      if (hackArmed && !hackRunning) {
        hint.textContent = "‚ö†Ô∏è –ü—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–≤–µ–¥—ë–Ω‚Ä¶ –ø–æ–ø—Ä–æ–±—É–π –Ω–∞–∂–∞—Ç—å ¬´–ù–µ—Ç¬ª –µ—â—ë —Ä–∞–∑ üòà";
      }
    }

    /**********************
     *  Background hearts
     **********************/
    function spawnBackgroundHearts(count=22, broken=false){
      const bg = $("bg");
      bg.innerHTML = "";
      const emojis = broken
        ? ["üíî","üñ§","üíî","üíî","ü©∂","üíî"]
        : [
          "üíñ","üíó","üíò","üíû","üíï","üíì","üíù","‚ù§Ô∏è","ü©∑","üß°","üíõ","üíö","ü©µ","üíô","üíú",
          "ü§ç","üñ§","ü§é","‚ù§Ô∏è‚Äçüî•","‚ù§Ô∏è‚Äçü©π","üíü","‚ù£Ô∏è","üíå","üíê","üå∏","üå∑","ü´∂","‚ú®","‚≠ê","üåü",
          "üéÄ","üß∏","üçì","üçí","üç≠","üç´","ü´ß","üåô","‚òÅÔ∏è","üïäÔ∏è","ü•∞","üòò","üòö"
        ];

      for(let i=0;i<count;i++){
        const el = document.createElement("div");
        el.className = "heart";
        el.textContent = emojis[(Math.random()*emojis.length)|0];

        const left = Math.random()*100;
        const duration = broken ? (6 + Math.random()*7) : (7 + Math.random()*9);
        const size = broken ? (0.9 + Math.random()*1.9) : (0.8 + Math.random()*1.6);
        const opacity = broken ? (0.32 + Math.random()*0.40) : (0.22 + Math.random()*0.35);
        const drift = (-35 + Math.random()*70) + "px";

        el.style.left = left + "vw";
        el.style.animationDuration = duration + "s";
        el.style.setProperty("--s", size);
        el.style.setProperty("--o", opacity);
        el.style.setProperty("--x", drift);
        el.style.animationDelay = (-Math.random()*duration) + "s";

        bg.appendChild(el);
      }
    }

    /**********************
     *  Restore / Reset (HOME)
     **********************/
    function restoreNoButtonToCard(){
      const ph = document.getElementById("noPlaceholder");
      if (ph) {
        ph.replaceWith(noBtn);
      } else if (!buttonsRow.contains(noBtn)) {
        buttonsRow.appendChild(noBtn);
      }

      noBtn.classList.remove("floating-no","shake","sad-walk");
      noBtn.style.left = "";
      noBtn.style.top  = "";
      noBtn.style.margin = "";
      noBtn.style.zIndex = "";
      noBtn.style.transform = "";
      noBtn.style.pointerEvents = "auto";
      noBtn.disabled = false;
      noBtn.textContent = "–ù–µ—Ç";

      noIsFixed = false;
    }

    function resetYesButton(){
      yesScale = 1;
      yesBtn.style.transform = "scale(1)";
      yesBtn.textContent = SETTINGS.yesLabels[0] || "–î–∞! üíñ";
      yesBtn.classList.add("pulse");
      yesBtn.disabled = false;
      yesBtn.style.pointerEvents = "auto";
      yesBtn.style.opacity = "1";
    }

    function clearConfetti(){
      if (animId) cancelAnimationFrame(animId);
      animId = null;
      particles = [];
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    function goHome(){
      // –∑–∞–∫—Ä—ã—Ç—å —Ö–∞–∫ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
      if (hackRunning) stopHackPrank();

      // –ø–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
      screenFinal.style.display = "none";
      screenAsk.style.display = "block";

      // —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π
      tries = 0;
      setTries(0);
      hackArmed = false;

      resetYesButton();
      restoreNoButtonToCard();

      hint.textContent = "";
      miniText.textContent = "–ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å ¬´–î–∞¬ª‚Ä¶ —è –Ω–µ –æ–±–∏–∂—É—Å—å üòÑ";
      updateMicrocopy();

      // —Ñ–æ–Ω/—á–∞—Å—Ç–∏—Ü—ã
      spawnBackgroundHearts(120, false);
      clearConfetti();
    }

    /**********************
     *  NO button: move to body + float
     **********************/
    function fixNoButtonToViewportOnce() {
      if (noIsFixed) return;

      const rect = noBtn.getBoundingClientRect();

      const ph = document.createElement("span");
      ph.id = "noPlaceholder";
      ph.style.display = "inline-block";
      ph.style.width = rect.width + "px";
      ph.style.height = rect.height + "px";
      noBtn.parentNode.insertBefore(ph, noBtn);

      document.body.appendChild(noBtn);
      noBtn.classList.add("floating-no");

      const margin = 14;
      const shift = SETTINGS.noInitialShiftRight || 0;

      const left = clamp(rect.left + shift, margin, window.innerWidth - rect.width - margin);
      const top  = clamp(rect.top, margin, window.innerHeight - rect.height - margin);

      noBtn.style.left = left + "px";
      noBtn.style.top  = top  + "px";
      noBtn.style.margin = "0";
      noBtn.style.zIndex = "99999";

      noIsFixed = true;
    }

    function sendNoToCorner() {
      fixNoButtonToViewportOnce();

      noBtn.classList.remove("shake");
      noBtn.classList.add("sad-walk");
      noBtn.textContent = "–ù–µ—Ç‚Ä¶ üòî";

      const margin = 16;
      const rect = noBtn.getBoundingClientRect();

      const targetX = margin;
      const targetY = window.innerHeight - rect.height - margin;

      const fromX = parseFloat(noBtn.style.left) || rect.left;
      const fromY = parseFloat(noBtn.style.top) || rect.top;

      const anim = noBtn.animate(
        [
          { left: fromX + "px", top: fromY + "px" },
          { left: targetX + "px", top: targetY + "px" }
        ],
        { duration: 2200, easing: "ease-in-out", fill: "forwards" }
      );

      anim.onfinish = () => {
        noBtn.style.left = targetX + "px";
        noBtn.style.top  = targetY + "px";
      };
    }

    function moveNoButton() {
      if (noMoveLock) return;
      noMoveLock = true;
      setTimeout(() => (noMoveLock = false), 140);

      lastNoActionTs = Date.now();

      if (screenFinal.style.display === "block") return;
      if (hackRunning) return;

      fixNoButtonToViewportOnce();

      if (hackArmed && noBtn.classList.contains("sad-walk")) {
        startHackPrank();
        return;
      }

      tries = clamp(tries + 1, 0, SETTINGS.maxTries);
      setTries(tries);

      yesBtn.classList.remove("pulse");

      const step =
        SETTINGS.yesScaleStepMin +
        Math.random() * (SETTINGS.yesScaleStepMax - SETTINGS.yesScaleStepMin);
      yesScale = Math.min(yesScale * step, SETTINGS.yesScaleMax);
      yesBtn.style.transform = `scale(${yesScale.toFixed(3)})`;

      // –º–µ–Ω—è–µ–º –Ω–∞–¥–ø–∏—Å—å –Ω–∞ YES (–Ω–æ –∫–ª–∏–∫ –ø–æ –Ω–µ–π –≤—Å–µ–≥–¥–∞ –≤–µ–¥—ë—Ç –≤ —Ñ–∏–Ω–∞–ª)
      const label = SETTINGS.yesLabels[clamp(tries, 0, SETTINGS.yesLabels.length - 1)];
      yesBtn.textContent = label;

      updateMicrocopy();

      if (tries === SETTINGS.maxTries) {
        hackArmed = true;
        sendNoToCorner();
        updateMicrocopy();
        return;
      }

      if (tries >= SETTINGS.funnyModeAfter) {
        noBtn.classList.add("shake");
        noBtn.textContent = "–ù–µ—Ç‚Ä¶ –Ω—É";
        const shrink = clamp(1 - (tries - SETTINGS.funnyModeAfter) * 0.10, 0.55, 1);
        noBtn.style.transform = `scale(${shrink})`;
      }

      const margin = 14;
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const rect = noBtn.getBoundingClientRect();
      const bw = rect.width;
      const bh = rect.height;

      const maxX = Math.max(margin, vw - bw - margin);
      const maxY = Math.max(margin, vh - bh - margin);

      const biasToCenter = tries >= 3 ? 0.55 : 0.35;
      const rand = (a, b) => a + Math.random() * (b - a);

      let x = rand(margin, maxX);
      let y = rand(margin, maxY);

      if (Math.random() < biasToCenter) {
        const cx = vw * 0.5;
        const cy = vh * 0.55;
        x = clamp(cx + rand(-vw * 0.25, vw * 0.25), margin, maxX);
        y = clamp(cy + rand(-vh * 0.18, vh * 0.18), margin, maxY);
      }

      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
    }

    /**********************
     *  NO listeners
     **********************/
    noBtn.addEventListener("pointerdown", (e) => {
      if (hackRunning) return;
      e.preventDefault();
      e.stopPropagation();
      moveNoButton();
      unlockAudioOnce();
    }, { passive:false });

    noBtn.addEventListener("click", (e) => {
      if (Date.now() - lastNoActionTs < 180) { e.preventDefault(); return; }
      if (hackRunning) return;
      e.preventDefault();
      moveNoButton();
    });

    /**********************
     *  Hack prank mode
     **********************/
    const hackLines = [
      "boot: LOVE_VIRUS.EXE",
      "mode: playful_prank",
      "scan: üíñ feelings...",
      "found: 1x cutie",
      "decrypt: smile_key ‚úÖ",
      "upload: hugs_packet... 37%",
      "inject: chocolate üç´",
      "override: NO_button",
      "warning: unstoppable_cuteness",
      "final: press STOP to exit"
    ];

    function startHackPrank(){
      if (hackRunning) return;
      hackRunning = true;
      startHackAudio();
      // –±–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ NO (–∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ), YES –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–π,
      // –Ω–æ overlay –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω ‚Äî –ø–æ—ç—Ç–æ–º—É STOP –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ–º–æ–π.
      noBtn.style.pointerEvents = "none";
      noBtn.style.zIndex = "99999";
      noBtn.style.display = "inline-flex";

      document.body.classList.add("dark-hack");
      spawnBackgroundHearts(28, true);

      hackOverlay.classList.add("active");
      hackOverlay.setAttribute("aria-hidden", "false");
      hackWindows.innerHTML = "";
      hackCount = 0;

      hackCenter.classList.remove("show");

      clearInterval(hackTimer);
      hackTimer = setInterval(() => {
        spawnTermWindow();
        hackCount++;

        if (hackCount === SETTINGS.hack.centerShowAfter) {
          hackCenter.classList.add("show");
        }

        if (hackCount >= SETTINGS.hack.maxWindows) {
          clearInterval(hackTimer);
          hackTimer = null;
          hackCenter.classList.add("show");
        }
      }, SETTINGS.hack.spawnIntervalMs);
    }

    function stopHackPrank(){
      hackRunning = false;
      hackArmed = false;
      stopHackAudio();
      clearInterval(hackTimer);
      hackTimer = null;

      hackOverlay.classList.remove("active");
      hackOverlay.setAttribute("aria-hidden", "true");
      hackCenter.classList.remove("show");
      hackWindows.innerHTML = "";

      document.body.classList.remove("dark-hack");
      spawnBackgroundHearts(120, false);

      noBtn.style.pointerEvents = "auto";
    }

    function spawnTermWindow(){
      const w = document.createElement("div");
      w.className = "term";
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span><span style="margin-left:6px">terminal_${hackCount+1}.exe</span>`;
      const pre = document.createElement("pre");

      const chunk = [];
      const linesCount = 4 + Math.floor(Math.random()*3);
      for (let i=0;i<linesCount;i++){
        chunk.push(hackLines[Math.floor(Math.random()*hackLines.length)]);
      }
      chunk.push(">");

      pre.textContent = chunk.join("\n");
      w.appendChild(bar);
      w.appendChild(pre);

      const margin = 10;
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const ww = Math.min(360, Math.max(220, 220 + Math.floor(Math.random()*180)));
      const hh = Math.min(190, Math.max(120, 120 + Math.floor(Math.random()*90)));
      w.style.width = ww + "px";
      w.style.height = hh + "px";

      const maxX = Math.max(margin, vw - ww - margin);
      const maxY = Math.max(margin, vh - hh - margin);

      const x = margin + Math.random() * (maxX - margin);
      const y = margin + Math.random() * (maxY - margin);

      w.style.left = x + "px";
      w.style.top  = y + "px";

      hackWindows.appendChild(w);
    }

    // ‚úÖ STOP: –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é + —Å–±—Ä–æ—Å YES
    hackStopBtn.addEventListener("click", () => {
      stopHackPrank();
      goHome();
    });

    /**********************
     *  YES: ALWAYS GO FINAL
     **********************/
    yesBtn.addEventListener("click", () => {
      unlockAudioOnce();

      if (screenFinal.style.display === "block") return;

      // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ hack –∑–∞–ø—É—â–µ–Ω ‚Äî —Å–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –ø–æ—Ç–æ–º —Ñ–∏–Ω–∞–ª
      if (hackRunning) stopHackPrank();

      fixNoButtonToViewportOnce();

      yesBtn.disabled = true;
      noBtn.disabled = true;

      celebrate();
      setTimeout(() => { goFinal(); }, 420);
    });

    function goFinal(){
      screenAsk.style.display = "none";
      screenFinal.style.display = "block";

      noBtn.style.display = "none";
      const ph = document.getElementById("noPlaceholder");
      if (ph) ph.remove();

      $("finalTitle").animate(
        [{transform:"scale(1)"},{transform:"scale(1.05)"},{transform:"scale(1)"}],
        {duration: 700, easing:"ease-in-out"}
      );
    }

    /**********************
     *  Calendar (ICS)
     **********************/
    function buildICS({title, location, start, end, description}) {
      const uid = cryptoRandomId() + "@valentine";
      const dtstamp = toICSDate(new Date());
      const lines = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//Valentine Invite//RU//EN",
        "CALSCALE:GREGORIAN",
        "METHOD:PUBLISH",
        "BEGIN:VEVENT",
        `UID:${uid}`,
        `DTSTAMP:${dtstamp}`,
        `DTSTART:${start}`,
        `DTEND:${end}`,
        `SUMMARY:${escapeICS(title)}`,
        `DESCRIPTION:${escapeICS(description)}`,
        `LOCATION:${escapeICS(location)}`,
        "END:VEVENT",
        "END:VCALENDAR"
      ];
      return lines.join("\r\n");
    }

    function escapeICS(s){
      return String(s || "")
        .replace(/\\/g, "\\\\")
        .replace(/\n/g, "\\n")
        .replace(/,/g, "\\,")
        .replace(/;/g, "\\;");
    }

    function toICSDate(d){
      const pad = (n) => String(n).padStart(2,"0");
      return d.getUTCFullYear()
        + pad(d.getUTCMonth()+1)
        + pad(d.getUTCDate())
        + "T"
        + pad(d.getUTCHours())
        + pad(d.getUTCMinutes())
        + pad(d.getUTCSeconds())
        + "Z";
    }

    function cryptoRandomId(){
      try{
        const arr = new Uint8Array(8);
        crypto.getRandomValues(arr);
        return Array.from(arr).map(b => b.toString(16).padStart(2,"0")).join("");
      }catch{
        return String(Math.random()).slice(2);
      }
    }

    function setupLinksAndDetails(){
      dDate.textContent = SETTINGS.dateText;
      dTime.textContent = SETTINGS.timeText;
      dPlace.textContent = SETTINGS.placeText;

      mapLink.href = SETTINGS.mapUrl;
      chatLink.href = SETTINGS.chatUrl;

      const ics = buildICS(SETTINGS.event);
      const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
      calLink.href = URL.createObjectURL(blob);
    }

    /**********************
     *  Confetti
     **********************/
    function resizeCanvas(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }

    window.addEventListener("resize", () => {
      resizeCanvas();
      if (noIsFixed && noBtn.style.display !== "none") {
        const r = noBtn.getBoundingClientRect();
        const margin = 14;
        const x = clamp(r.left, margin, window.innerWidth - r.width - margin);
        const y = clamp(r.top,  margin, window.innerHeight - r.height - margin);
        noBtn.style.left = x + "px";
        noBtn.style.top  = y + "px";
      }
    });

    let particles = [];
    let animId = null;

    function celebrate(){
      resizeCanvas();
      burstHearts(140);
      flash();
      animateConfetti(1400);
      setTimeout(() => burstHearts(90), 220);
      setTimeout(() => burstHearts(70), 430);
    }

    function flash(){
      const el = document.createElement("div");
      el.style.position = "fixed";
      el.style.inset = "0";
      el.style.background = "rgba(255,255,255,.55)";
      el.style.zIndex = "4";
      el.style.pointerEvents = "none";
      el.style.opacity = "0";
      el.style.transition = "opacity .22s ease";
      document.body.appendChild(el);
      requestAnimationFrame(() => el.style.opacity = "1");
      setTimeout(() => el.style.opacity = "0", 180);
      setTimeout(() => el.remove(), 450);
    }

    function burstHearts(n){
      const centerX = window.innerWidth * 0.5;
      const centerY = window.innerHeight * 0.48;

      for(let i=0;i<n;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 2.4 + Math.random()*4.6;
        const size = 7 + Math.random()*10;

        particles.push({
          x: centerX + (Math.random()*20-10),
          y: centerY + (Math.random()*16-8),
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed - (1.4 + Math.random()*2.2),
          g: 0.08 + Math.random()*0.08,
          r: size,
          rot: Math.random()*Math.PI,
          vr: (Math.random()*0.14 - 0.07),
          life: 60 + (Math.random()*40|0),
          alpha: 1
        });
      }
    }

    function drawHeart(x,y,size,rot,alpha){
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(rot);
      ctx.globalAlpha = alpha;

      const s = size;
      ctx.beginPath();
      ctx.moveTo(0, s*0.35);
      ctx.bezierCurveTo(0, -s*0.1, -s*0.6, -s*0.1, -s*0.6, s*0.35);
      ctx.bezierCurveTo(-s*0.6, s*0.7, -s*0.25, s*0.95, 0, s*1.15);
      ctx.bezierCurveTo(s*0.25, s*0.95, s*0.6, s*0.7, s*0.6, s*0.35);
      ctx.bezierCurveTo(s*0.6, -s*0.1, 0, -s*0.1, 0, s*0.35);
      ctx.closePath();

      const pink = Math.random() < 0.5;
      ctx.fillStyle = pink ? "rgba(255,95,162,.85)" : "rgba(255,255,255,.85)";
      ctx.fill();

      ctx.restore();
    }

    function animateConfetti(ms){
      const start = performance.now();
      if (animId) cancelAnimationFrame(animId);

      function frame(t){
        const elapsed = t - start;
        ctx.clearRect(0,0,canvas.width,canvas.height);

        particles = particles.filter(p => p.life > 0);

        for (const p of particles){
          p.x += p.vx;
          p.y += p.vy;
          p.vy += p.g;
          p.rot += p.vr;
          p.life -= 1;
          p.alpha = clamp(p.life / 90, 0, 1);
          drawHeart(p.x, p.y, p.r, p.rot, p.alpha);
        }

        if (elapsed < ms || particles.length > 0) {
          animId = requestAnimationFrame(frame);
        } else {
          ctx.clearRect(0,0,canvas.width,canvas.height);
        }
      }
      animId = requestAnimationFrame(frame);
    }

    /**********************
     *  Music
     **********************/
    const bgm = document.getElementById("bgm");
    const musicBtn = document.getElementById("musicBtn");
    // INTRO open + start music
    const hackBgm = document.getElementById("hackBgm");

// –∑–∞–ø–æ–º–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ã—á–Ω–æ–π –º—É–∑—ã–∫–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
let savedBgmTime = 0;
let savedBgmWasPlaying = false;

async function startHackAudio(){
  // –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∫–ª—é—á–∏–ª –º—É–∑—ã–∫—É ‚Äî –Ω–µ –≤–∫–ª—é—á–∞–µ–º ‚Äú—Ö–∞–∫–µ—Ä—Å–∫–æ–µ‚Äù
  if (!musicOn) return;

  // —ç—Ç–æ—Ç –∑–∞–ø—É—Å–∫ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç –∏–∑ user gesture (–∫–ª–∏–∫ –ø–æ NO) ‚Äî –º–æ–∂–Ω–æ —Å–º–µ–ª–æ ‚Äú—Ä–∞–∑–ª–æ—á–∏—Ç—å‚Äù
  soundUnlocked = true;

  // —Å—Ç–æ–ø –æ–±—ã—á–Ω–æ–π
  try{
    savedBgmTime = bgm.currentTime || 0;
    savedBgmWasPlaying = !bgm.paused && !bgm.ended;
    bgm.pause();
  } catch(e) {}

  // —Å—Ç–∞—Ä—Ç —Ö–∞–∫–µ—Ä—Å–∫–æ–π
  try{
    hackBgm.currentTime = 0;
    hackBgm.muted = false;
    hackBgm.volume = 0.35;
    await hackBgm.play();
  } catch(e) {}

  setMusicBtnUI();
}

async function stopHackAudio(){
  // —Å—Ç–æ–ø —Ö–∞–∫–µ—Ä—Å–∫–æ–π
  try{
    hackBgm.pause();
    hackBgm.currentTime = 0;
  } catch(e) {}

  // –≤–µ—Ä–Ω—É—Ç—å –æ–±—ã—á–Ω—É—é (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å)
  if (!musicOn) { setMusicBtnUI(); return; }

  try{
    bgm.muted = false;
    bgm.volume = 0.25;

    // –ø—Ä–æ–¥–æ–ª–∂–∏–º —Å –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏
    if (!Number.isNaN(savedBgmTime)) {
      bgm.currentTime = savedBgmTime;
    }

    // –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ –∏–≥—Ä–∞–ª–∞ –¥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
    if (savedBgmWasPlaying || soundUnlocked) {
      await bgm.play();
    }
  } catch(e) {}

  setMusicBtnUI();
}
const intro = document.getElementById("intro");
const introSeal = document.getElementById("introSeal");

async function startMusicFromIntro(){
  const a = document.getElementById("bgm");
  if (!a) return;

  // –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Ñ–ª–∞–≥–∏ –∏–∑ —Ç–≤–æ–µ–≥–æ music-–∫–æ–¥–∞ ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –≤—ã—Å—Ç–∞–≤–∏–º
  if (typeof musicOn !== "undefined") musicOn = true;
  if (typeof soundUnlocked !== "undefined") soundUnlocked = true;

  try{
    a.muted = false;
    a.volume = 0.25;
    await a.play();
  } catch (e) {
    // –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª ‚Äî –æ–±—ã—á–Ω–æ —ç—Ç–æ —Ä–µ–¥–∫–æ—Å—Ç—å, –Ω–æ –∏–Ω—Ç—Ä–æ-–∫–ª–∏–∫ –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å
  }

  if (typeof setMusicBtnUI === "function") setMusicBtnUI();
}

function openIntro(){
  if (!intro) return;

  // —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "–±–µ–ª–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø–æ—Å–ª–µ" ‚Äî –º—ã –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º overlay
  intro.classList.add("open");

  // —á–µ—Ä–µ–∑ —á—É—Ç—å-—á—É—Ç—å –ø–ª–∞–≤–Ω–æ "—Ä–∞—Å—Ç–≤–æ—Ä—è–µ–º" overlay –∏ —Å–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫–ª–∏–∫–æ–≤
  setTimeout(() => {
    intro.classList.add("gone");
    intro.setAttribute("aria-hidden", "true");
  }, 900);

  // –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ–º –∏–∑ DOM
  setTimeout(() => {
    intro.remove();
  }, 1400);
}

if (intro && introSeal) {
  // –º–æ–∂–Ω–æ –∫–ª–∏–∫–∞—Ç—å –ø–æ –ø–µ—á–∞—Ç–∏
  introSeal.addEventListener("click", async () => {
    await startMusicFromIntro();
    openIntro();
  }, { once: true });

  // –∏ –ø–æ —Å–∞–º–æ–º—É –∫–æ–Ω–≤–µ—Ä—Ç—É (–Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–º–∞—Ö–∞)
  document.getElementById("env")?.addEventListener("click", async () => {
    await startMusicFromIntro();
    openIntro();
  }, { once: true });
}
    let musicOn = true;
    let soundUnlocked = false;

    function setMusicBtnUI(){
      musicBtn.textContent = musicOn ? "üîä Music" : "üîà Music";
    }

    async function tryAutoplay(){
      try{
        bgm.volume = 0.25;
        bgm.muted = true;
        await bgm.play();
      } catch (e) {} finally {
        setMusicBtnUI();
      }
    }

    async function unlockSoundOnce(){
      if (soundUnlocked) return;
      soundUnlocked = true;
      if (!musicOn) return;

      try{
        bgm.muted = false;
        bgm.volume = 0.25;
        await bgm.play();
      } catch (e) {}
    }

    // –∞–ª–∏–∞—Å, —á—Ç–æ–±—ã –≤—Å—ë —Å—Ç–∞—Ä–æ–µ —Ä–∞–±–æ—Ç–∞–ª–æ –±–µ–∑ –æ—à–∏–±–æ–∫
    function unlockAudioOnce(){
      unlockSoundOnce();
    }

    window.addEventListener("load", tryAutoplay);
    document.addEventListener("pointerdown", unlockSoundOnce, { once:true, passive:true });

    musicBtn.addEventListener("click", async () => {
      musicOn = !musicOn;

      if (musicOn) {
        try{
          bgm.muted = !soundUnlocked;
          bgm.volume = 0.25;
          await bgm.play();
        } catch (e) {}
      } else {
        bgm.pause();
      }

      setMusicBtnUI();
    });

    /**********************
     *  Init
     **********************/
    (function init(){
      const name = getNameFromQuery();
      nameSpan.textContent = name;

      renderInviteLines(SETTINGS.inviteLines);
      setupLinksAndDetails();
      spawnBackgroundHearts(120, false);

      setTries(0);
      updateMicrocopy();

      resizeCanvas();
    })();
  </script>
</body>
</html>
